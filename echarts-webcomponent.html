<link rel="import" href="../polymer/polymer-element.html">
<script src="../echarts/dist/echarts.min.js"></script>

<dom-module id="echarts-webcomponent">
    <template>
        <style>
             :host {
                display: block;
            }

        </style>
        <div id="container" style="width: 100%; height: 100%;"></div>
    </template>

    <script>
        /**
         * `echarts-webcomponent`
         * webcomponent of echarts
         *
         * @customElement
         * @polymer
         * @demo demo/index.html
         */
        class EchartsWebcomponent extends Polymer.Element {
            static get is() {
                return 'echarts-webcomponent';
            }
            static get properties() {
                return {
                    option: {
                        type: String,
                        value: ''
                    }
                };
            }
            connectedCallback() {
                super.connectedCallback();
                if (!this.chart) {
                    this.chart = echarts.init(this.$.container);
                    this.updateChart();
                }
            }
            disconnectedCallback() {
                super.disconnectedCallback();
                this.chart.dispose();
                this.chart = null;
            }
            attributeChangedCallback(name, oldValue, newValue) {
                super.attributeChangedCallback(name, oldValue, newValue);
                if (name === "option") {
                    this.updateChart();
                } else if (name === "style") {
                    this.$.container.style = newValue;
                    this.resizeChart();
                }
            }
            updateChart() {
                if (!this.chart) return;
                let option = JSON.parse(this.option || "{}");
                this.chart.setOption(option);;
            }
            resizeChart() {
                if (!this.chart) return;
                this.chart.resize();
            }
        }

        window.customElements.define(EchartsWebcomponent.is, EchartsWebcomponent);

    </script>
</dom-module>
